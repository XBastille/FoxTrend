<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediction</title>
    <script src='https://cdn.plot.ly/plotly-2.32.0.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"></script>
    <link rel="stylesheet" href="../public/predict_stock.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Protest+Guerrilla&display=swap" rel="stylesheet">
</head>

<body>

    <ul class="icons open">
        <a href="#" class="fox-icon-link">
            <img src="public/Media/fox.jpg" alt="Fox Icon" class="logo">
        </a>
        <li class="Icon-items" data-name="Home">
            <img src="public/Media/home.jpg" id="item1">
            <span class="icon-name">Home</span>
        </li>
        <li class="Icon-items" data-name="Watch">
            <img src="public/Media/recent_watch.jpg" id="item2">
            <span class="icon-name">Watch</span>
        </li>
        <li class="Icon-items" data-name="Lists">
            <img src="public/Media/list.jpg" id="item3">
            <span class="icon-name">Lists</span>
        </li>
        <li class="Icon-items" data-name="Donate">
            <img src="public/Media/donate.jpg" id="item4">
            <span class="icon-name">Donate</span>
        </li>
        <a href="/userprofile">
            <li class="Icon-items" data-name="Profile">
                <img src="public/Media/account.jpg" id="item5" />
                <button id="profile"><span class="icon-name">Profile</span></button>
            </li>
        </a>
        <li class="Arrow">
            <img src="public/Media/arrow-right.jpg">
        </li>
    </ul>
    <div class="search-container">
        <input type="text" class="search-bar" placeholder="Search">
        <i class="search-icon fas fa-search"></i>
        <div class="magnifying-glass">
            <i class="fa-solid fa-magnifying-glass"></i>
        </div>
        <div class="navigationBar">
            <a href="#" class="serv">
                Services
                <svg width="20" height="20" viewBox="0 -4 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round"
                        stroke-linejoin="round"></path>
                </svg>
            </a>
            <a href="#" class="comp">
                Project
                <svg width="20" height="20" viewBox="0 -4 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round"
                        stroke-linejoin="round"></path>
                </svg>
            </a>
            <a href="https://github.com/XBastille/FoxTrend" target="_blank" class="blog">Github</a>
            <a href="https://mail.google.com/mail/?view=cm&fs=1&to=eziopuhan825@gmail.com" target="_blank"
                class="port">Contact Us</a>
            <div class="services-dropdown">
                <div class="services-dropdown-content">
                    <div class="services-label">
                        <h1>Services</h1>
                    </div>
                    <div class="services-dropdown-column">
                        <div class="primary-section">
                            <h2>Primary <span class="arrow">→</span></h2>
                            <div class="primary-elements">
                                <a href="#">Stock Market Prediction</a>
                            </div>
                        </div>
                    </div>
                    <div class="services-dropdown-column">
                        <div class="secondary-section">
                            <h3>Secondary <span class="arrow">→</span></h3>
                            <div class="secondary-elements">
                                <a href="/selectcar">Used Car Prediction</a>
                                <a href="/selecthouse">Housing Prediction</a>
                                <a href="/selectloan">Loan Approval Prediction</a>
                            </div>
                        </div>
                    </div>
                    <img src="public/Media/services.jpg" alt="Your Alt Text" class="service-image">
                </div>
            </div>
            <div class="company-dropdown">
                <div class="company-dropdown-content">
                    <div class="company-label">
                        <h1>Project</h1>
                    </div>
                    <div class="company-dropdown-column">
                        <h2>MORE ABOUT US</h2>
                        <a href="/#about-section">About Us</a>
                        <a href="https://github.com/XBastille/FoxTrend" target="_blank">Github</a>
                        <a href="#">Privacy Policy</a>
                        <a href="#">License</a>
                    </div>
                    <div class="company-dropdown-column">
                        <h2>SOCIAL</h2>
                        <a href="/social" target="_blank">LinkedIn</a>
                        <a href="/social" target="_blank">Instagram</a>
                        <a href="/social" target="_blank">X</a>
                    </div>
                    <div class="company-dropdown-column">
                        <h2>CONTACTS</h2>
                        <a href="#">Donate</a>
                        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=eziopuhan825@gmail.com"
                            target="_blank">Mail Us</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        ul {
            list-style-type: none;
            padding-inline-start: 0;
        }
    </style>

    <div class="prediction-title-container">
        <h1 class="prediction-title">Prediction</h1>
    </div>

    <div class="desc" style="margin-left: 200px">
        <h1 id="Company_title">Tesla Inc.</h1>
        <h1 id="Company_price"></h1>
        <span id="dollar"></span>
        <span id="percent"></span>
        <br><br><br>
        <br>
    </div>
    <div id="myplot" style="width:1100px; height:400px; margin-left: 160px; margin-bottom: 0px;"></div>
    <div class="table-container">
        <p id="download-data" class="download-btn">Download Data</p>
        <table id="prediction-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Pred (Closing Price)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <footer>
        <div class="footer-links">
            <img src="public/Media/website_logo.jpg" class="foot-logo" />
            <div class="footer-block">
                <div class="footer-title" id="Comp">Project</div>
                <li><a style="text-decoration: none;" class="links"
                        href="https://mail.google.com/mail/?view=cm&fs=1&to=eziopuhan825@gmail.com" target="_blank"
                        id="mail">Mail us</a></li>
                <li><a href="https://github.com/XBastille/FoxTrend" style="text-decoration: none;" target="_blank"
                        class="links" id="SERV">Github</a></li>
                <li><a href="#" style="text-decoration: none;" target="_blank" class="links" id="SERV">Donate</a></li>
            </div>

            <div class="footer-block">
                <div class="footer-title" id="more">More</div>
                <li><a class="links" id="career">License</a></li>
                <li><a class="links" id="privacy">Privacy Policy</a></li>
            </div>

            <div class="footer-block">
                <div class="footer-title" id="social">Social</div>
                <li><a class="links" style="text-decoration: none;" href="/social" target="_blank"
                        id="linkedin">LinkedIn</a></li>
                <li><a class="links" style="text-decoration: none;" href="/social" target="_blank" id="yt">Instagram</a>
                </li>
                <li><a class="links" style="text-decoration: none;" href="/social" target="_blank" id="tw">X</a></li>
            </div>
        </div>
    </footer>
    <script>
        //graph and table
        Papa.parse("/public/prediction.csv", {
            download: true,
            header: true,
            complete: function (results) {
                const xarray = [];
                const yarray = [];

                results.data.forEach(row => {
                    xarray.push(row['date']);
                    yarray.push(parseFloat(row['Close']));
                });

                const data = [
                    {
                        x: xarray,
                        y: [],
                        mode: "lines",
                        type: "scatter",
                        fill: "tozeroy",
                        fillgradient: {
                            type: "vertical",
                            colorscale: [
                                [0, "rgba(0,0,0,0)"],
                                [1, "rgba(96,0,147,1)"],
                            ],
                        },
                        line: {
                            width: 2,
                        },
                        hovertemplate:
                            '%{x}' +
                            '<extra></extra>',
                    },
                ];

                const layout = {
                    xaxis: {
                        range: [xarray[0], xarray[xarray.length - 1]],
                        title: {
                            font: {
                                color: "white",
                            },
                        },
                        tickfont: {
                            color: "white",
                        },
                        spikedash: "solid",
                        spikemode: "toaxis",
                        spikecolor: "white",
                        spikethickness: 1,

                    },
                    yaxis: {
                        range: [0, Math.max(...yarray) + 20],
                        title: {
                            font: {
                                color: "black",
                            },
                        },
                        tickfont: {
                            color: "black",
                        },
                        tickvals: []
                    },
                    colorway: ["#7834a8"],
                    plot_bgcolor: "black",
                    paper_bgcolor: "black",
                    hoverlabel: {
                        bgcolor: "black",
                        bordercolor: "black",
                        font: {
                            color: "white",
                            size: 15,
                            lineposition: "closest",
                            align: "right"
                        },
                        hovermode: "x",
                        newshape: {
                            line: {
                                dash: "solid",
                                color: "white"
                            },
                            showlegend: "true"
                        },

                    }
                };

                Plotly.newPlot("myplot", data, layout).then(function () {
                    const myPlot = document.getElementById('myplot');

                    myPlot.on('plotly_hover', function (data) {
                        const price = data.points[0].y;
                        document.getElementById('Company_price').textContent = `$${price.toFixed(2)}`;
                    });

                    if (yarray.length > 0) {
                        document.getElementById('Company_price').textContent = `$${yarray[yarray.length - 1].toFixed(2)}`;
                    }
                });

                const tbody = document.querySelector('#prediction-table tbody');
                results.data.forEach(row => {
                    if (row.date && row.Close) {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
    <td>${row.date}</td>
    <td>$${parseFloat(row.Close).toFixed(2)}</td>
`;
                        tbody.appendChild(tr);
                    }
                });

                let i = 0;
                let id;
                function animate() {
                    if (i < xarray.length) {
                        Plotly.extendTraces("myplot", {
                            x: [[xarray[i]]],
                            y: [[yarray[i]]]
                        }, [0]);
                        i++;
                        id = requestAnimationFrame(animate);
                    }
                }
                animate();

                document.getElementById('download-data').addEventListener('click', function (e) {
                    alert('hello')
                    e.preventDefault();
                    let csv = 'Date,Close\n';
                    results.data.forEach(row => {
                        if (row.date && row.Close) {
                            csv += `${row.date},${row.Close}\n`;
                        }
                    });

                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'prediction.csv';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                });
            }

        });

        //connecting the data wiht json file like comany name
        let val = '';
        const Company_price = document.getElementById('Company_price')
        const Company_title = document.getElementById('Company_title')
        async function companaming() {
            try {
                const res = await fetch('/public/graph.json')
                if (!res.ok) {
                    console.log(res.status)
                    return;
                }
                const data = await res.json();
                val = data.symbol
                Company_price.innerText = "$" + data.currentPrice
                Company_title.innerText = data.shortName
                console.log(data.shortName)
            } catch (error) {
                console.log(error)
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            companaming();
        });


    </script>

    <script src="../public/predict_stock.js"></script>
</body>

</html>