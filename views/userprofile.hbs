<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <script src='https://cdn.plot.ly/plotly-2.32.0.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="/public/userprofile.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Protest+Guerrilla&display=swap" rel="stylesheet">
</head>

<body>

    <ul class="icons open">
        <a href="#" class="fox-icon-link">
            <img src="public/Media/fox.jpg" alt="Fox Icon" class="logo">
        </a>
        <a href="/dashboard">
            <li class="Icon-items" data-name="Home">
                <img src="public/Media/home.jpg" id="item1" />
                <button><span class="icon-name">Home</span></button>
            </li>
        </a>
        <li class="Icon-items" data-name="Watch">
            <img src="public/Media/recent_watch.jpg" id="item2">
            <button id="wat"><span class="icon-name">Watch</span></button>
        </li>
        <li class="Icon-items" data-name="Lists">
            <img src="public/Media/list.jpg" id="item3">
            <button id="lst"><span class="icon-name">Lists</span></button>
        </li>
        <a href="https://github.com/XBastille/FoxTrend/blob/main/.github/FUNDING.yml" target="_blank" style="text-decoration: none;">
        <li class="Icon-items" data-name="Donate">
            <img src="public/Media/donate.jpg" id="item4">
            <span class="icon-name">Donate</span>
        </li>
        </a>
        <li class="Icon-items" data-name="Profile">
            <img src="public/Media/account.jpg" id="item5">
            <button id="prf"><span class="icon-name">Profile</span></button>
        </li>
        <li class="Arrow">
            <img src="public/Media/arrow-right.jpg">
        </li>
    </ul>
    <div class="search-container">
        <input type="text" class="search-bar" placeholder="Search">
        <i class="search-icon fas fa-search"></i>
        <div class="magnifying-glass">
            <i class="fa-solid fa-magnifying-glass"></i>
        </div>
        <div class="navigationBar">
            <a href="#" class="serv">
                Services
                <svg width="20" height="20" viewBox="0 -4 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round"
                        stroke-linejoin="round"></path>
                </svg>
            </a>
            <a href="#" class="comp">
                Project
                <svg width="20" height="20" viewBox="0 -4 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="1.67" stroke-linecap="round"
                        stroke-linejoin="round"></path>
                </svg>
            </a>
            <a href="#" class="blog">Blog</a>
            <a href="#" class="port">Contact Us</a>
            <div class="services-dropdown">
                <div class="services-dropdown-content">
                    <div class="services-label">
                        <h1>Services</h1>
                    </div>
                    <div class="services-dropdown-column">
                        <div class="primary-section">
                            <h2>Primary <span class="arrow">→</span></h2>
                            <div class="primary-elements">
                                <a href="#">Stock Market Prediction</a>
                            </div>
                        </div>
                    </div>
                    <div class="services-dropdown-column">
                        <h3>Secondary <span class="arrow">→</span></h3>
                        <div class="secondary-section">
                            <div class="secondary-elements">
                                <a href="#">Used Car Prediction</a>
                                <a href="#">Housing Prediction</a>
                                <a href="#">Loan Approval Prediction</a>
                            </div>
                        </div>
                    </div>
                    <img src="public/Media/services.jpg" alt="Your Alt Text" class="service-image">
                </div>
            </div>
            <div class="company-dropdown">
                <div class="company-dropdown-content">
                    <div class="company-label">
                        <h1>Project</h1>
                    </div>
                    <div class="company-dropdown-column">
                        <h2>MORE ABOUT US</h2>
                        <a href="/journey">About Us</a>
                        <a href="#">Blog</a>
                        <a href="#">Privacy Policy</a>
                        <a href="#">License</a>
                    </div>
                    <div class="company-dropdown-column">
                        <h2>SOCIAL</h2>
                        <a href="/social" target="_blank">LinkedIn</a>
                        <a href="/social" target="_blank">Instagram</a>
                        <a href="/social" target="_blank">X</a>
                    </div>
                    <div class="company-dropdown-column">
                        <h2>CONTACTS</h2>
                        <a href="#">Book a Call</a>
                        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=eziopuhan825@gmail.com"
                            target="_blank">Mail Us</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        ul {
            list-style-type: none;
            padding-inline-start: 0;
        }
    </style>
    <div class="profile-container">
        <div class="profile-header">
            <div class="avatar-container">
                <img src="public/Media/fox.jpg" alt="User Avatar" class="avatar">
                <i class="fas fa-pen avatar-edit"></i>
            </div>
            <h1>{{username}}</h1>
        </div>
        <div class="avatar-popup">
            <div class="avatar-selection">
                <div class="avatar-grid">
                    <img src="public/Media/fox.jpg" class="avatar-option selected" alt="Avatar 1">
                    <img src="public/Media/fox_1.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_2.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_4.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_5.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_6.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_7.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_8.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_9.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_10.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_11.jpg" class="avatar-option" alt="Avatar 2">
                    <img src="public/Media/fox_12.jpg" class="avatar-option" alt="Avatar 2">
                </div>
                <button class="select-button">
                    <i class="fas fa-check"></i> Select Avatar
                </button>
            </div>
        </div>
        <form class="profile-section" method="POST" action="/userprofile">
            <h2>Personal Information</h2>
            <div class="profile-field">
                <label>Name:</label>
                <input type="text" name="name" id="name" value="{{name}}">
            </div>
            <div class="profile-field">
                <label>Username:</label>
                <input type="text" id="username" name="username" value="{{username}}">
            </div>
            <div class="profile-field">
                <label>Email:</label>

                <input type="email" id="email" name="email" value={{email}}>
            </div>
            <div class="profile-field">
                <label>Password:</label>
                <input type="password" id="password" name="password">
            </div>
            <div class="profile-field confirm-password">
                <label>Confirm Password:</label>
                <input type="password" id="confirm_password" name="confirm_password">
            </div>
            <button class="edit-button" id="submitbutton">
                <i class="fas fa-pen"></i> Edit Info
            </button>
        </form>
        <div class="profile-section">
            <h2>Connected Accounts</h2>
            <div class="connected-accounts">
                <div class="account-item" data-account="google">
                    <div class="account-info">
                        <img src="public/Media/google-logo.jpg" alt="Google" class="account-icon">
                    </div>
                    <button class="connect-button">Connect</button>
                </div>
                <div class="account-item" data-account="github">
                    <div class="account-info">
                        <img src="public/Media/github.jpg" alt="GitHub" class="account-icon">
                    </div>
                    <button class="connect-button">Connect</button>
                </div>
                <div class="account-item" data-account="linkedin">
                    <div class="account-info">
                        <img src="public/Media/linkedin-logo.jpg" alt="LinkedIn" class="account-icon">
                    </div>
                    <button class="connect-button">Connect</button>
                </div>
                <div class="account-item" data-account="microsoft">
                    <div class="account-info">
                        <img src="public/Media/microsoft-logo.jpg" alt="Microsoft" class="account-icon">
                    </div>
                    <button class="connect-button">Connect</button>
                </div>
            </div>
        </div>
    </div>
    <footer>
            <div class="footer-links">
                <img src="public/Media/website_logo.jpg" class="foot-logo" />
                <div class="footer-block">
                    <div class="footer-title" id="Comp">Project</div>
                    <li><a style="text-decoration: none;" class="links"
                            href="https://mail.google.com/mail/?view=cm&fs=1&to=eziopuhan825@gmail.com"
                            target="_blank" id="mail">Mail us</a></li>
                    <li><a href="https://github.com/XBastille/FoxTrend" style="text-decoration: none;" target="_blank" class="links" id="SERV">Github</a></li>
                    <li><a href="https://github.com/XBastille/FoxTrend/blob/main/.github/FUNDING.yml" style="text-decoration: none;" target="_blank" class="links" id="SERV">Donate</a></li>
                </div>

                <div class="footer-block">
                    <div class="footer-title" id="more">More</div>
                    <li><a class="links" id="career">License</a></li>
                    <li><a class="links" id="privacy">Privacy Policy</a></li>
                </div>

                <div class="footer-block">
                    <div class="footer-title" id="social">Social</div>
                    <li><a class="links" style="text-decoration: none;" href="/social" target="_blank" id="linkedin">LinkedIn</a></li>
                    <li><a class="links" style="text-decoration: none;" href="/social" target="_blank" id="yt">Instagram</a></li>
                    <li><a class="links" style="text-decoration: none;" href="/social" target="_blank" id="tw">X</a></li>
                </div>
            </div>
        </footer>
    <script>
        const wat = document.getElementById('wat')
        wat.addEventListener('click', () => {
            window.location.href = '/watch'
        })

        const lst = document.getElementById('lst')
        lst.addEventListener('click', () => {
            window.location.href = '/yourList'
        })

        const prf = document.getElementById('prf')
        prf.addEventListener('click', () => {
            window.location.href = '/userprofile'
        })

        let c = 0;

        let formdata = {
            username: "",
        }

        const nhi = "false"
        async function handless() {
            try {
                const response = await fetch('/userprofile', {
                    method: 'POST',
                    headers: {
                        'Content-type': 'application/json'
                    },
                    body: JSON.stringify(formdata)
                })
                const datas = await response.json()
                console.log(datas)
                return datas.success === 'false' ? 'false' : 'true';
            } catch (error) {
                console.log(error)
            }
        }

        function formdatas() {
            formdata.username = document.getElementById("username").value.trim()
            console.log(formdata)
        }



        document.addEventListener('DOMContentLoaded', function () {
            const editButton = document.querySelector('.edit-button');
            const profileForm = document.querySelector('.profile-section');
            const profileFields = document.querySelectorAll('.profile-field');
            const avatarUsername = document.querySelector('.profile-header h1');
            const confirmPasswordField = document.querySelector('.confirm-password');
            const submitbutton = document.getElementById('submitbutton');

            profileFields.forEach(field => {
                const input = field.querySelector('input');
                if (input) {
                    input.disabled = true;
                }
            });

            confirmPasswordField.style.display = 'none';

            submitbutton.addEventListener('click', async (event) => {
                event.preventDefault();
                c++;

                const name = document.getElementById('name').value;
                const username = document.getElementById('username').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirm_password = document.getElementById('confirm_password').value;

                if (c % 2 !== 0) {
                    try {
                        const emailResponse = await fetch('/userprofile', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                email: email
                            })
                        });

                        const response = await fetch('/userprofile', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                emails: email,
                                passwords: password,
                                name: name,
                                usernames: username
                            })
                        });

                        const data = await response.json();
                        if (data.success !== 'false') {
                            window.location.reload();
                        }
                    } catch (error) {
                        console.error('Error:', error);
                    }
                } else {
                    formdatas();
                    const result = await handless();

                    if (result === 'false') {
                        c = 1;
                        window.location.href = '/username';
                        return;
                    }

                    if (password !== confirm_password) {
                        c = 1;
                        return;
                    }

                    if (!email.endsWith("@gmail.com")) {
                        c = 1;
                        return;
                    }

                    const formData = new FormData();
                    formData.append('email', email);
                    formData.append('emails', email);
                    formData.append('passwords', password);
                    formData.append('name', name);
                    formData.append('usernames', username);

                    const response = await fetch('/userprofile', {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        window.location.reload();
                    }
                }
            });

            function validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            }

            function clearError(field) {
                const errorMessage = field.querySelector('.error-message');
                if (errorMessage) errorMessage.remove();
                field.querySelectorAll('input').forEach(input => input.classList.remove('error'));
            }

            editButton.addEventListener('click', function () {
                if (this.textContent.trim() === 'Edit Info') {
                    profileFields.forEach(field => {
                        const input = field.querySelector('input');
                        if (input) {
                            input.disabled = false;
                        }
                    });
                    confirmPasswordField.style.display = 'flex';
                    this.textContent = 'Save Info';
                } else {
                    let isValid = true;

                    profileFields.forEach(field => {
                        clearError(field);
                        const input = field.querySelector('input');
                        if (input && input.type === 'email' && !validateEmail(input.value)) {
                            isValid = false;
                            input.classList.add('error');
                        }
                    });

                    const passwordField = document.querySelector('.profile-field input[type="password"]');
                    const confirmPasswordInput = document.querySelector('.confirm-password input');
                    if (passwordField.value !== confirmPasswordInput.value) {
                        isValid = false;
                    }

                    if (isValid) {
                        submitbutton.click();

                        profileFields.forEach(field => {
                            const input = field.querySelector('input');
                            if (input) {
                                input.disabled = true;
                            }
                        });
                        confirmPasswordField.style.display = 'none';
                        this.textContent = 'Edit Info';
                    }
                }
            });

            profileFields.forEach(field => {
                const inputs = field.querySelectorAll('input');
                inputs.forEach(input => {
                    input.addEventListener('input', () => clearError(field));
                });
            });
        });




    </script>
    <script src="/public/Stockspage.js"></script>
</body>

</html>
